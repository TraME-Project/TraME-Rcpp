#!/bin/bash
## TraME R config script

R_INCLUDE_PATH="${R_HOME}/include"

if [[ "${TRAVIS}" == "true" ]]; then
    RCPP_ARMADILLO_INCLUDE_PATH="-I/usr/local/lib/R/site-library/Rcpp/include -I/usr/local/lib/R/site-library/RcppArmadillo/include"
else 
    RCPP_ARMADILLO_INCLUDE_PATH="-I${R_HOME}/library/Rcpp/include -I${R_HOME}/library/RcppArmadillo/include"
fi

export ARMA_INCLUDE_PATH="${R_INCLUDE_PATH} ${RCPP_ARMADILLO_INCLUDE_PATH} -DUSE_RCPP_ARMADILLO"
export TRAME_R_VERSION="yes"
export TRAME_BLAS_LIBS="${BLAS_LIBS}"
export TRAME_LAPACK_LIBS="${LAPACK_LIBS}"

#if [[ !(-e src/trame/libtrame.so) ]] ; then
    cd src/trame
    ./configure -l glpk
    make
    mkdir ../../inst
    mkdir ../../inst/libs
    cp ./libtrame.so ../../inst/libs/libtrame.so
    cd ../..
#fi

sed -e "s|@R_INCLUDE_PATH@|${R_INCLUDE_PATH}|" \
    -e "s|@RCPP_ARMADILLO_INCLUDE_PATH@|${RCPP_ARMADILLO_INCLUDE_PATH}|" \
    src/Makevars.in > src/Makevars
